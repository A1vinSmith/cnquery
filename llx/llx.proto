syntax = "proto3";

package mondoo.llx;
option go_package = "llx";

message Primitive {
  string type = 1;

  // The value of the primitive in case of bool|int|float|string|ref|json
  // For array/map it holds the exact datatype as a string,
  // e.g. []int or map[string]string
  bytes value = 2;

  // In case of an array primitive, holds the data of the array
  repeated Primitive array = 3;

  // In case of a map primitive, holds the data of the map
  map<string, Primitive> map = 4;
}

message Function {
  string type = 1;
  int32 binding = 2;
  repeated Primitive args = 3;
}

message Chunk {
  enum Call {
    PRIMITIVE = 0;
    FUNCTION = 1;
  }
  Call call = 1;
  string id = 2;
  Primitive primitive = 3;
  Function function = 4;
}

message Code {
  string id = 1;
  repeated Chunk code = 2;
  int32 parameters = 3;
  repeated int32 entrypoints = 4;
  map<int32,string> checksums = 5;
  repeated Code functions = 6;
}

message Labels {
  map<int32,string> labels = 1;
  map<int32,Labels> functions = 2;
}

message CodeBundle {
  Code code = 1;
  repeated string suggestions = 2;
  string source = 3;
  Labels labels = 4;
}

message Result {
  mondoo.llx.Primitive data = 1;
  string error = 2;
  string code_id = 3;
}

message Rating {
  string id = 1; // can either be the collection or the query
  string endpoint = 2;
  int32 tests = 3;
  int32 score = 4;
  int32 trend = 5;
  string date = 6;
}
